
Running AITER...
AITER (AMD) reference average execution time: 0.5743 ms
AITER (AMD) reference performance: 598.28 TFLOPS for b=16 h=16 n=1024 d=128 causal=False.

Running PyTorch reference...
PyTorch reference average execution time: 9.3038 ms
PyTorch reference performance: 36.93 TFLOPS for b=16 h=16 n=1024 d=128 causal=False.

Running Tiled forward to get L...

Running ThunderKittens ...
ThunderKittens average execution time: 0.5022 ms
ThunderKittens performance: 684.14 TFLOPS for b=16 h=16 n=1024 d=128 causal=False.


AITER vs PyTorch comparison:
Output max error: 0.000715
Q grad max error: 0.001323
K grad max error: 0.000955
V grad max error: 0.000703

Tiled vs PyTorch comparison:
Output max error: 0.000000
Q grad max error: 0.000000
K grad max error: 0.000000
V grad max error: 0.000000

TK vs PyTorch comparison:

Delta outputs:
TK:  tensor([ 0.380, -0.842, -0.886, -0.168,  0.148, -0.479, -0.329,  0.569], device='cuda:0') Max: 1.6139674186706543
TK Out:  tensor([ 0.380, -0.842, -0.886, -0.168,  0.148, -0.479, -0.329,  0.569], device='cuda:0') Max: 1.6139674186706543
PyTorch:  tensor([ 0.381, -0.842, -0.886, -0.168,  0.148, -0.479, -0.329,  0.568], device='cuda:0', grad_fn=<SelectBackward0>) Max: 1.6145967245101929

Gradient K outputs:
TK:  tensor([[0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.]], device='cuda:0', dtype=torch.bfloat16) Max: 0.0
PyTorch:  tensor([[-0.011,  0.034, -0.018, -0.008,  0.010, -0.031,  0.043,  0.063],
        [-0.044,  0.023, -0.043, -0.044,  0.006, -0.040,  0.006, -0.027],
        [ 0.011, -0.069,  0.001,  0.006,  0.000,  0.013,  0.044,  0.048],
        [ 0.029, -0.019,  0.017, -0.013,  0.016,  0.048,  0.019,  0.025],
        [-0.028,  0.037,  0.038,  0.002, -0.026, -0.040,  0.022,  0.034],
        [-0.013,  0.046, -0.075,  0.037, -0.017,  0.000,  0.008,  0.010],
        [-0.029, -0.026,  0.012, -0.019, -0.037, -0.000,  0.007,  0.054],
        [-0.011,  0.022, -0.036, -0.006, -0.005, -0.006, -0.038, -0.005]], device='cuda:0', dtype=torch.float64) Max: 0.2105724628597405

Gradient V outputs:
TK:  tensor([[0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.]], device='cuda:0', dtype=torch.bfloat16) Max: 0.0
PyTorch:  tensor([[ 0.016,  0.021, -0.037, -0.045, -0.003, -0.027, -0.072,  0.019],
        [ 0.029,  0.037, -0.059,  0.067,  0.021, -0.005, -0.049,  0.017],
        [ 0.045,  0.049,  0.017, -0.012,  0.021,  0.048, -0.080,  0.044],
        [ 0.014,  0.012, -0.022,  0.050,  0.050,  0.015, -0.021,  0.027],
        [ 0.046,  0.044, -0.034,  0.032, -0.013,  0.016, -0.084,  0.035],
        [ 0.048,  0.025, -0.022,  0.018,  0.020,  0.019, -0.113,  0.043],
        [-0.014,  0.023, -0.042, -0.000,  0.010, -0.003, -0.075,  0.010],
        [ 0.071,  0.057, -0.045,  0.029,  0.021,  0.070, -0.087,  0.021]], device='cuda:0', dtype=torch.float64) Max: 0.21951694363538707

Gradient Q outputs:
TK:  tensor([[0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.],
        [0., 0., 0., 0., 0., 0., 0., 0.]], device='cuda:0', dtype=torch.bfloat16) Max: 0.0
PyTorch:  tensor([[ 0.054, -0.023,  0.019,  0.040, -0.029, -0.023, -0.002,  0.012],
        [ 0.016, -0.004, -0.012, -0.020, -0.022,  0.003,  0.020,  0.016],
        [-0.017, -0.035, -0.003,  0.011,  0.034,  0.027, -0.028,  0.020],
        [-0.014, -0.025, -0.034,  0.005, -0.021, -0.014, -0.022, -0.017],
        [ 0.046,  0.047,  0.006,  0.039, -0.039,  0.037,  0.012,  0.097],
        [ 0.005,  0.019, -0.048,  0.090, -0.005, -0.005, -0.059,  0.019],
        [-0.028,  0.042, -0.002, -0.003, -0.016,  0.024,  0.002,  0.038],
        [-0.014, -0.006, -0.007,  0.004, -0.018,  0.023,  0.019,  0.029]], device='cuda:0', dtype=torch.float64) Max: 0.20449722026867342

TK vs Tiled comparison:
Gradient S outputs:
TK:  tensor([[    -0.000,      0.002,     -0.000,      0.000,     -0.000,     -0.000,     -0.001,      0.000],
        [     0.000,     -0.000,     -0.000,     -0.003,     -0.000,      0.001,      0.000,     -0.000],
        [     0.000,     -0.001,     -0.001,     -0.000,     -0.000,      0.002,     -0.001,      0.000],
        [     0.001,     -0.000,     -0.000,     -0.000,      0.000,     -0.000,     -0.001,      0.002],
        [    -0.001,      0.000,     -0.000,      0.000,      0.000,      0.000,     -0.000,      0.002],
        [    -0.001,      0.000,     -0.000,      0.000,     -0.000,      0.000,     -0.003,     -0.000],
        [     0.001,      0.001,     -0.000,     -0.001,      0.001,      0.000,     -0.000,      0.000],
        [    -0.000,     -0.000,      0.000,      0.000,     -0.001,     -0.000,     -0.000,     -0.001]], device='cuda:0', dtype=torch.bfloat16) Max: 0.07763671875
Tiled:  tensor([[-0.000,  0.019, -0.002,  0.002, -0.001, -0.003, -0.008,  0.001],
        [ 0.003, -0.001, -0.000, -0.039, -0.005,  0.007,  0.001, -0.003],
        [ 0.003, -0.006, -0.007, -0.002, -0.001,  0.019, -0.013,  0.004],
        [ 0.009, -0.003, -0.002, -0.001,  0.003, -0.003, -0.008,  0.028],
        [-0.008,  0.005, -0.004,  0.001,  0.000,  0.003, -0.003,  0.021],
        [-0.008,  0.003, -0.000,  0.001, -0.003,  0.000, -0.038, -0.003],
        [ 0.010,  0.007, -0.001, -0.006,  0.006,  0.004, -0.001,  0.005],
        [-0.000, -0.001,  0.004,  0.004, -0.006, -0.000, -0.002, -0.016]], device='cuda:0', grad_fn=<SliceBackward0>) Max: 0.8816559314727783
Diff:  tensor([[ 0.000, -0.018,  0.002, -0.002,  0.001,  0.002,  0.007, -0.001],
        [-0.003,  0.001,  0.000,  0.035,  0.005, -0.006, -0.001,  0.002],
        [-0.002,  0.005,  0.006,  0.002,  0.001, -0.017,  0.012, -0.003],
        [-0.008,  0.003,  0.002,  0.001, -0.003,  0.003,  0.007, -0.025],
        [ 0.008, -0.005,  0.003, -0.001, -0.000, -0.003,  0.003, -0.019],
        [ 0.007, -0.003,  0.000, -0.001,  0.003, -0.000,  0.034,  0.003],
        [-0.009, -0.006,  0.001,  0.005, -0.006, -0.004,  0.001, -0.005],
        [ 0.000,  0.001, -0.003, -0.004,  0.005,  0.000,  0.002,  0.015]], device='cuda:0', grad_fn=<SliceBackward0>) Max: 0.738932192325592

Robustness checks (TK vs PyTorch):
Delta: max_abs=0.002960, max_rel=0.0012, rel_l2=0.0017, cos=0.999999, errors=315/262144 (0.1202%)
Delta out: max_abs=0.002960, max_rel=0.0012, rel_l2=0.0017, cos=0.999999, errors=315/262144 (0.1202%)
Q grad: max_abs=0.209832, max_rel=0.9707, rel_l2=1.0000, cos=0.000000, errors=32570894/33554432 (97.0688%)
K grad: max_abs=0.247092, max_rel=0.9708, rel_l2=1.0000, cos=0.000000, errors=32575604/33554432 (97.0829%)
V grad: max_abs=0.219517, max_rel=0.9775, rel_l2=1.0000, cos=0.000000, errors=32798377/33554432 (97.7468%)
S grad: max_abs=0.804019, max_rel=0.8130, rel_l2=0.9119, cos=0.999999, errors=218246956/268435456 (81.3033%)
